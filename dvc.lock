schema: '2.0'
stages:
  download_data:
    cmd: kaggle datasets download -d ruchi798/bookcrossing-dataset -p data/raw/
    outs:
    - path: data/raw/bookcrossing-dataset.zip
      hash: md5
      md5: 50bce6d5bd23374f829227a31b21d884
      size: 79772605
  extract_dataset:
    cmd: unzip data/raw/bookcrossing-dataset.zip -d data/raw/
    deps:
    - path: data/raw/bookcrossing-dataset.zip
      hash: md5
      md5: 50bce6d5bd23374f829227a31b21d884
      size: 79772605
    outs:
    - path: data/raw/Book reviews/Book reviews/BX-Book-Ratings.csv
      hash: md5
      md5: 7ab62f5bddcc82f47cbed0615530805a
      size: 30682276
    - path: data/raw/Book reviews/Book reviews/BX-Users.csv
      hash: md5
      md5: cca22ab4cb53125b5d503496597123a5
      size: 12284157
    - path: data/raw/Book reviews/Book reviews/BX_Books.csv
      hash: md5
      md5: 04b9710434f92eadabc0709a5d97a8bc
      size: 77430569
    - path: data/raw/Books Data with Category Language and Summary/Preprocessed_data.csv
      hash: md5
      md5: dea9206a46573038decd0977c0433616
      size: 479942599
  download_dataset:
    cmd: kaggle datasets download -d ruchi798/bookcrossing-dataset -p data/raw/
    outs:
    - path: data/raw/bookcrossing-dataset.zip
      hash: md5
      md5: 50bce6d5bd23374f829227a31b21d884
      size: 79772605
  pack_dataset:
    cmd: poetry run python -m src.dataset "data/raw/Book reviews/Book reviews/BX-Users.csv"
      "data/raw/Book reviews/Book reviews/BX_Books.csv" "data/raw/Book reviews/Book
      reviews/BX-Book-Ratings.csv" data/interim/dataset.cloudpickle --limit=0
    deps:
    - path: data/raw/Book reviews/Book reviews/BX-Book-Ratings.csv
      hash: md5
      md5: 7ab62f5bddcc82f47cbed0615530805a
      size: 30682276
    - path: data/raw/Book reviews/Book reviews/BX-Users.csv
      hash: md5
      md5: cca22ab4cb53125b5d503496597123a5
      size: 12284157
    - path: data/raw/Book reviews/Book reviews/BX_Books.csv
      hash: md5
      md5: 04b9710434f92eadabc0709a5d97a8bc
      size: 77430569
    - path: src/dataset.py
      hash: md5
      md5: 11fc566fde50a21a4eb08e84a4f73992
      size: 5876
    outs:
    - path: data/interim/dataset.cloudpickle
      hash: md5
      md5: 5173458e8cd9fca873ca7fb5d30d07e6
      size: 93850967
  build_features:
    cmd: poetry run python -m src.features data/interim/dataset.cloudpickle data/interim/features.cloudpickle
      --chunk_size=200 --device=cuda
    deps:
    - path: data/interim/dataset.cloudpickle
      hash: md5
      md5: 5173458e8cd9fca873ca7fb5d30d07e6
      size: 93850967
    - path: src/features.py
      hash: md5
      md5: 806d18033fd9db1ae5b008ca64fe761a
      size: 4999
    outs:
    - path: data/interim/features.cloudpickle
      hash: md5
      md5: 015f1f3c1d4a8d8ab1aa4a8fac3dfe08
      size: 834300286
  train:
    cmd: poetry run python -m src.modeling.train data/interim/features.cloudpickle
      models/model.pth --num_epochs=5 --batch_size=64
    deps:
    - path: data/interim/features.cloudpickle
      hash: md5
      md5: f2d0911ba9d9a19a6d8476f58d29f9e3
      size: 834300286
    - path: src/modeling/data_loader.py
      hash: md5
      md5: 6f27fb16cae0232f9524efd0a62e96d2
      size: 1530
    - path: src/modeling/model.py
      hash: md5
      md5: c39880347aa0964b274eefc5913d0c33
      size: 856
    - path: src/modeling/train.py
      hash: md5
      md5: 9ea2cef7cf192101ebb477b2636ec12b
      size: 7640
    outs:
    - path: models/model.pth
      hash: md5
      md5: 548693caff6016277dedb0c6d2c9d86c
      size: 2368296
  predict:
    cmd: poetry run python -m src.modeling.predict data/interim/features.cloudpickle
      models/model.pth data/processed/predicted.parquet
    deps:
    - path: data/interim/features.cloudpickle
      hash: md5
      md5: f2d0911ba9d9a19a6d8476f58d29f9e3
      size: 834300286
    - path: models/model.pth
      hash: md5
      md5: ca9ee46fc24ab32c4a8ce0a8592edf34
      size: 2368296
    - path: src/modeling/data_loader.py
      hash: md5
      md5: 6f27fb16cae0232f9524efd0a62e96d2
      size: 1530
    - path: src/modeling/model.py
      hash: md5
      md5: c39880347aa0964b274eefc5913d0c33
      size: 856
    - path: src/modeling/predict.py
      hash: md5
      md5: a9922fda7435b9ec52e7c103f91e18d1
      size: 7027
    outs:
    - path: data/processed/predicted.parquet
      hash: md5
      md5: 102a64d308fe965d6b767dc67573f248
      size: 354645
  train@benchmark:
    cmd: poetry run python -m src.modeling.train data/interim/features.cloudpickle
      models/model_benchmark.pth --device=cuda --num_epochs 10 --batch_size 64 --model_save_interval_epochs
      1 --proba_threshold 0.5 --dropout_p 0.5 --log_interval 100 --loss_margin 0.0
      --hidden_dim 384 --output_dim 384 --lr 0.001
    deps:
    - path: data/interim/features.cloudpickle
      hash: md5
      md5: 015f1f3c1d4a8d8ab1aa4a8fac3dfe08
      size: 834300286
    - path: src/modeling/data_loader.py
      hash: md5
      md5: 6f27fb16cae0232f9524efd0a62e96d2
      size: 1530
    - path: src/modeling/model.py
      hash: md5
      md5: c39880347aa0964b274eefc5913d0c33
      size: 856
    - path: src/modeling/train.py
      hash: md5
      md5: dddd965833d9aa7ac031b0377e8d2ca5
      size: 10002
    outs:
    - path: models/model_benchmark.pth
      hash: md5
      md5: e17ad525fbc5f0d32d97db909c42d854
      size: 2369056
  train@setup_1:
    cmd: poetry run python -m src.modeling.train data/interim/features.cloudpickle
      models/model_setup_1.pth --device=cuda --num_epochs 10 --batch_size 64 --model_save_interval_epochs
      5 --proba_threshold 0.5 --dropout_p 0.5 --log_interval 500 --loss_margin 0.0
      --hidden_dim 128 --output_dim 64 --lr 0.0005
    deps:
    - path: data/interim/features.cloudpickle
      hash: md5
      md5: 64cd57f894f4144df3b6dd6a7403add7
      size: 14954411
    - path: src/modeling/data_loader.py
      hash: md5
      md5: 6f27fb16cae0232f9524efd0a62e96d2
      size: 1530
    - path: src/modeling/model.py
      hash: md5
      md5: c39880347aa0964b274eefc5913d0c33
      size: 856
    - path: src/modeling/train.py
      hash: md5
      md5: dddd965833d9aa7ac031b0377e8d2ca5
      size: 10002
    outs:
    - path: models/model_setup_1.pth
      hash: md5
      md5: 1c98d94595a99568272cc14f5dd472fd
      size: 463816
  train@setup_2:
    cmd: poetry run python -m src.modeling.train data/interim/features.cloudpickle
      models/model_setup_2.pth --device=cuda --num_epochs 10 --batch_size 64 --model_save_interval_epochs
      5 --proba_threshold 0.5 --dropout_p 0.5 --log_interval 500 --loss_margin 0.0
      --hidden_dim 128 --output_dim 64 --lr 0.001
    deps:
    - path: data/interim/features.cloudpickle
      hash: md5
      md5: 64cd57f894f4144df3b6dd6a7403add7
      size: 14954411
    - path: src/modeling/data_loader.py
      hash: md5
      md5: 6f27fb16cae0232f9524efd0a62e96d2
      size: 1530
    - path: src/modeling/model.py
      hash: md5
      md5: c39880347aa0964b274eefc5913d0c33
      size: 856
    - path: src/modeling/train.py
      hash: md5
      md5: dddd965833d9aa7ac031b0377e8d2ca5
      size: 10002
    outs:
    - path: models/model_setup_2.pth
      hash: md5
      md5: aea473a5340afac31f7c243fc834757c
      size: 463816
  predict@benchmark:
    cmd: poetry run python -m src.modeling.predict data/interim/features.cloudpickle
      models/model_benchmark.pth data/processed/predicted_benchmark.parquet --device
      cuda --hidden_dim 384 --output_dim 384 --dropout_p 0.5
    deps:
    - path: data/interim/features.cloudpickle
      hash: md5
      md5: 64cd57f894f4144df3b6dd6a7403add7
      size: 14954411
    - path: models/model_benchmark.pth
      hash: md5
      md5: 9d646139dc6bfb09d376be3ef12758b1
      size: 2369056
    - path: src/modeling/data_loader.py
      hash: md5
      md5: 6f27fb16cae0232f9524efd0a62e96d2
      size: 1530
    - path: src/modeling/model.py
      hash: md5
      md5: c39880347aa0964b274eefc5913d0c33
      size: 856
    - path: src/modeling/predict.py
      hash: md5
      md5: b13131784164031f02b4b3ccf1d9c11d
      size: 3398
    outs:
    - path: data/processed/predicted_benchmark.parquet
      hash: md5
      md5: 6909a86dae20a202b05266668d5bf359
      size: 2484
  predict@setup_1:
    cmd: poetry run python -m src.modeling.predict data/interim/features.cloudpickle
      models/model_setup_1.pth data/processed/predicted_setup_1.parquet --device cuda
      --hidden_dim 128 --output_dim 64 --dropout_p 0.5
    deps:
    - path: data/interim/features.cloudpickle
      hash: md5
      md5: 64cd57f894f4144df3b6dd6a7403add7
      size: 14954411
    - path: models/model_setup_1.pth
      hash: md5
      md5: 1c98d94595a99568272cc14f5dd472fd
      size: 463816
    - path: src/modeling/data_loader.py
      hash: md5
      md5: 6f27fb16cae0232f9524efd0a62e96d2
      size: 1530
    - path: src/modeling/model.py
      hash: md5
      md5: c39880347aa0964b274eefc5913d0c33
      size: 856
    - path: src/modeling/predict.py
      hash: md5
      md5: b13131784164031f02b4b3ccf1d9c11d
      size: 3398
    outs:
    - path: data/processed/predicted_setup_1.parquet
      hash: md5
      md5: 20a420c2a63c8873c766318d1cc49da5
      size: 2480
  predict@setup_2:
    cmd: poetry run python -m src.modeling.predict data/interim/features.cloudpickle
      models/model_setup_2.pth data/processed/predicted_setup_2.parquet --device cuda
      --hidden_dim 128 --output_dim 64 --dropout_p 0.5
    deps:
    - path: data/interim/features.cloudpickle
      hash: md5
      md5: 64cd57f894f4144df3b6dd6a7403add7
      size: 14954411
    - path: models/model_setup_2.pth
      hash: md5
      md5: aea473a5340afac31f7c243fc834757c
      size: 463816
    - path: src/modeling/data_loader.py
      hash: md5
      md5: 6f27fb16cae0232f9524efd0a62e96d2
      size: 1530
    - path: src/modeling/model.py
      hash: md5
      md5: c39880347aa0964b274eefc5913d0c33
      size: 856
    - path: src/modeling/predict.py
      hash: md5
      md5: b13131784164031f02b4b3ccf1d9c11d
      size: 3398
    outs:
    - path: data/processed/predicted_setup_2.parquet
      hash: md5
      md5: 2a189c3fa29e2768e640674c1a45b72f
      size: 2481
  evaluate@benchmark:
    cmd: poetry run python -m src.evaluate data/processed/predicted.parquet reports/figures/evaluate-benchmark/
    deps:
    - path: data/processed/predicted_benchmark.parquet
      hash: md5
      md5: 6909a86dae20a202b05266668d5bf359
      size: 2484
    - path: src/evaluate.py
      hash: md5
      md5: 32e780df4df29c7a5ab4c73600e21ee5
      size: 5482
    outs:
    - path: reports/figures/evaluate-benchmark/
      hash: md5
      md5: fdebc3d8a1e1dfd81c77f69a78b0454f.dir
      size: 90574
      nfiles: 1
  evaluate@setup_1:
    cmd: poetry run python -m src.evaluate data/processed/predicted.parquet reports/figures/evaluate-setup_1/
    deps:
    - path: data/processed/predicted_setup_1.parquet
      hash: md5
      md5: 20a420c2a63c8873c766318d1cc49da5
      size: 2480
    - path: src/evaluate.py
      hash: md5
      md5: 32e780df4df29c7a5ab4c73600e21ee5
      size: 5482
    outs:
    - path: reports/figures/evaluate-setup_1/
      hash: md5
      md5: fdebc3d8a1e1dfd81c77f69a78b0454f.dir
      size: 90574
      nfiles: 1
  evaluate@setup_2:
    cmd: poetry run python -m src.evaluate data/processed/predicted.parquet reports/figures/evaluate-setup_2/
    deps:
    - path: data/processed/predicted_setup_2.parquet
      hash: md5
      md5: 2a189c3fa29e2768e640674c1a45b72f
      size: 2481
    - path: src/evaluate.py
      hash: md5
      md5: 32e780df4df29c7a5ab4c73600e21ee5
      size: 5482
    outs:
    - path: reports/figures/evaluate-setup_2/
      hash: md5
      md5: fdebc3d8a1e1dfd81c77f69a78b0454f.dir
      size: 90574
      nfiles: 1
